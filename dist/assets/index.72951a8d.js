const p=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerpolicy&&(i.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?i.credentials="include":r.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}};p();var style="";class layer{constructor(n,t){this.length=n,this.inputLength=t,this.weights=[],this.costGradientWeight=[],this.costGradientBias=[];for(var e=0;e<this.length;e++){this.costGradientBias[e]=0,this.costGradientWeight[e]=[],this.weights[e]=[];for(var r=0;r<this.inputLength;r++)this.costGradientWeight[e][r]=0,this.weights[e][r]=1}this.weightedInputs=[],this.activations=[],this.inputs=[]}clearGradient(){this.weightedInputs=[],this.activations=[],this.inputs=[];for(var n=0;n<this.length;n++)for(var t=0;t<this.inputLength;t++)this.costGradientWeight[n][t]=0}reLu(n){return n>0?n:0}Predict(n){var t=[];this.inputs=n;for(var e=0;e<this.length;e++){t[e]=0;for(var r=0;r<this.inputLength;r++)t[e]+=this.weights[e][r]*n[r];this.weightedInputs[e]=t[e],this.activations[e]=this.reLu(t[e]),t[e]=this.activations[e]}return t}applyCostGradient(n){for(var t=0;t<this.length;t++)for(var e=0;e<this.inputLength;e++)this.weights[t][e]-=n*this.costGradientWeight[t][e]}nodeCostDerivative(n,t){return 2*(n-t)}activationDerivative(n){return n>0?1:0}CalculateNodeValues(n){for(var t=[],e=0;e<this.length;e++){const r=this.nodeCostDerivative(this.activations[e],n[e]),i=this.activationDerivative(this.weightedInputs[e]);t[e]=r*i}return t}updateGradients(n){for(var t=0;t<this.length;t++)for(var e=0;e<this.inputLength;e++)this.costGradientWeight[t][e]+=n[t]*this.inputs[e]}}class network{constructor(...n){this.layers=[];for(var t=0;t<n.length;t++)this.layers[t]=new layer(n[t],n[t-1]||0)}updateAllGradients(n,t){this.Predict(n);var e=this.layers[this.layers.length-1],r=e.CalculateNodeValues(t);e.updateGradients(r)}Predict(n){for(var t=n,e=1;e<this.layers.length;e++)t=this.layers[e].Predict(t);return t}Learn(n,t,e){for(var r=0;r<e;r++){for(var i=0;i<n.length;i++)this.updateAllGradients(n[i],t[i]);for(var i=1;i<this.layers.length;i++)this.layers[i].applyCostGradient(.1);for(const a of this.layers)a.clearGradient()}}}var nodeIndex=0;const nodeConnection={};function renderLayer(s){var n=document.createElement("div");n.className="svg-container";var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.style.height="100vh",t.style.width="100px";var e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("width","60px"),e.classList.add("node-container"),e.setAttribute("x","20px"),t.appendChild(e);const r=document.documentElement.clientHeight,i=r/(s.length+1),a=r-i,l=35;e.setAttribute("height",r-i*2+l*2+"px"),e.setAttribute("y",i-l+"px");for(var h=0;h<s.length;h++){const o=document.createElementNS("http://www.w3.org/2000/svg","circle");o.setAttribute("cx","50px"),o.setAttribute("cy",a/s.length*h+i+"px"),o.classList.add("node"),o.id="node-"+nodeIndex++,o.addEventListener("mouseover",f=>{for(const v of nodeConnection[o.id])v.classList.add("connection-active")}),o.addEventListener("mouseout",f=>{for(const v of nodeConnection[o.id])v.classList.remove("connection-active")}),t.appendChild(o)}return n.appendChild(t),n}function renderNetwork(s){var n=document.createElement("div");const t=document.documentElement.clientWidth,e=document.documentElement.clientHeight;var r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width",t+"px"),r.setAttribute("height",e+"px"),n.appendChild(r);const i=t/(s.layers.length+1),a=t-i;var l=null,h=null;console.log(s.layers);for(var o=0;o<s.layers.length;o++){const w=s.layers[o],u=renderLayer(w);console.log(u),u.style.position="absolute";var f=i-35+a/s.layers.length*o;u.style.left=f+"px";const b=u.querySelectorAll(".node"),N=f+50+"px";var v=Math.max(...w.weights.map(d=>Math.max(...d)));if(l!=null){var L=0;for(const d of l){var C=0;for(const m of b){const c=document.createElementNS("http://www.w3.org/2000/svg","line");nodeConnection[d.id]==null&&(nodeConnection[d.id]=[]),nodeConnection[m.id]==null&&(nodeConnection[m.id]=[]),nodeConnection[m.id].push(c),nodeConnection[d.id].push(c),c.setAttribute("x1",h),c.setAttribute("y1",d.getAttribute("cy")),c.setAttribute("x2",N),c.setAttribute("y2",m.getAttribute("cy"));var g=w.weights[C][L]/v*255;g=g/4+100,c.setAttribute("stroke",`rgb(${g},${g},${g})`),c.classList.add("connection"),r.appendChild(c),C++}L++}}l=b,h=N,n.appendChild(u)}return n}const app=document.querySelector("#app");var myNetwork=new network(2,2),x=[[2,1],[1,2]],y=[[1,2],[2,1]],input=document.getElementById("input"),output=document.getElementById("output");input.addEventListener("keydown",s=>{s.keyCode==13&&(localStorage.setItem("input",input.value),update())});input.value=localStorage.getItem("input");function update(){input.value!=""&&(output.value=myNetwork.Predict(eval(`[${input.value}]`)).map(s=>Math.round(s)))}const stdout=document.getElementById("stdout");function train(){myNetwork.Learn(x,y,1e3),stdout.innerHTML=JSON.stringify(myNetwork.layers.slice(1).map(s=>s.weights),null,2).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),update()}train();app.appendChild(renderNetwork(myNetwork));
